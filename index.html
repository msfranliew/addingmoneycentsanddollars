<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Money Practice</title>

<style>
  body {
    font-family: system-ui, -apple-system, Arial, sans-serif;
    max-width: 900px;
    margin: 30px auto;
    padding: 20px;
  }
  .card {
    border: 1px solid #ddd;
    border-radius: 16px;
    padding: 20px;
    margin-top: 16px;
  }
  .topbar {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    align-items: center;
    justify-content: space-between;
    border: 1px solid #eee;
    border-radius: 14px;
    padding: 12px 14px;
  }
  .pill {
    border: 1px solid #ddd;
    border-radius: 999px;
    padding: 8px 12px;
    font-weight: 700;
    font-size: 14px;
    white-space: nowrap;
  }
  .toggle {
    display: inline-flex;
    gap: 10px;
    align-items: center;
    font-weight: 700;
    user-select: none;
  }
  .toggle input { transform: scale(1.2); }
  .big {
    font-size: 28px;
    font-weight: 800;
    margin-bottom: 18px;
  }
  .step { margin-top: 14px; }
  input[type="number"], input[type="text"] {
    padding: 8px;
    font-size: 16px;
    width: 120px;
    border-radius: 8px;
    border: 1px solid #ccc;
  }
  button {
    padding: 10px 16px;
    font-size: 16px;
    border-radius: 10px;
    border: none;
    cursor: pointer;
    margin-top: 14px;
    margin-right: 8px;
  }
  .primary { background: #4CAF50; color: white; }
  .secondary { background: #2196F3; color: white; }
  .neutral { background: #555; color: white; }
  .feedback {
    margin-top: 14px;
    font-weight: 800;
    font-size: 18px;
    line-height: 1.3;
    white-space: pre-line;
  }
  .answerBox {
    margin-top: 10px;
    padding: 12px;
    border-radius: 12px;
    border: 1px dashed #999;
    display: none;
  }
  .smallnote {
    font-size: 13px;
    font-weight: 650;
    opacity: 0.85;
    margin-top: 6px;
  }
</style>
</head>

<body>
<h2>üí∞ Add or Subtract the Money</h2>

<div class="topbar">
  <div class="pill" id="scorePill">Score: 0 / 0</div>

  <label class="toggle" title="When mastery mode is ON, you must get 5 correct in a row.">
    <input id="masteryToggle" type="checkbox" onchange="toggleMastery()" />
    Mastery Mode (5 in a row)
  </label>

  <div class="pill" id="streakPill">Streak: 0</div>

  <button class="neutral" onclick="resetScore()">Reset Score</button>
</div>

<div class="card">
  <div class="big" id="question"></div>

  <div class="step">
    <strong>Step 1: Work out the dollars.</strong><br><br>
    $<input id="dollarsAnswer" type="number" />
  </div>

  <div class="step">
    <strong>Step 2: Work out the cents.</strong><br><br>
    <input id="centsAnswer" type="number" /> ¬¢
  </div>

  <div class="step">
    <strong>Step 3: Write the final answer.</strong><br><br>
    $<input id="finalAnswer" type="text" placeholder="e.g. 46.45" />
  </div>

  <button class="primary" onclick="checkAnswer()">Check Answer</button>
  <button class="secondary" onclick="generateQuestion()">New Question</button>

  <div class="feedback" id="feedback"></div>

  <div class="answerBox" id="answerBox">
    <div><strong>‚úÖ Correct answers:</strong></div>
    <div id="answerDetails"></div>
    <div class="smallnote">Tip: Read the steps and compare with your working.</div>
  </div>
</div>

<script>
let dollar1, dollar2, cent1, cent2;
let correctDollarTotal, correctCentTotal, correctFinal;
let operation; // "+" or "-"
let attempts = 0;

let scoreCorrect = 0;
let scoreTotal = 0;

let masteryOn = false;
let streak = 0;
const masteryTarget = 5;

function pad2(n) { return String(n).padStart(2, "0"); }

function updateHUD() {
  document.getElementById("scorePill").innerText = `Score: ${scoreCorrect} / ${scoreTotal}`;
  document.getElementById("streakPill").innerText = `Streak: ${streak}${masteryOn ? " / " + masteryTarget : ""}`;
}

function toggleMastery() {
  masteryOn = document.getElementById("masteryToggle").checked;
  // When turning mastery on, reset streak so it is clear and fair
  streak = 0;
  updateHUD();
  document.getElementById("feedback").innerText = masteryOn
    ? "Mastery Mode is ON.\nGoal: Get 5 correct in a row."
    : "Mastery Mode is OFF.";
  hideAnswerBox();
}

function resetScore() {
  scoreCorrect = 0;
  scoreTotal = 0;
  streak = 0;
  updateHUD();
  document.getElementById("feedback").innerText = "Score reset.";
  hideAnswerBox();
}

function generateNoCarryAdditionCents() {
  const c1 = Math.floor(Math.random() * 100);
  const c2 = Math.floor(Math.random() * (100 - c1)); // ensures c1+c2 <= 99
  return [c1, c2];
}

function generateNoBorrowSubtractionCents() {
  const c1 = Math.floor(Math.random() * 100);
  const c2 = Math.floor(Math.random() * (c1 + 1)); // ensures c1 >= c2
  return [c1, c2];
}

function generateQuestion() {
  attempts = 0;
  hideAnswerBox();

  operation = Math.random() < 0.5 ? "+" : "-";

  if (operation === "+") {
    dollar1 = Math.floor(Math.random() * 90) + 10;
    dollar2 = Math.floor(Math.random() * 90) + 10;
    [cent1, cent2] = generateNoCarryAdditionCents();

    correctDollarTotal = dollar1 + dollar2;
    correctCentTotal = cent1 + cent2;
  } else {
    dollar1 = Math.floor(Math.random() * 90) + 20;
    dollar2 = Math.floor(Math.random() * (dollar1 + 1)); // ensures dollar1 >= dollar2
    [cent1, cent2] = generateNoBorrowSubtractionCents();

    correctDollarTotal = dollar1 - dollar2;
    correctCentTotal = cent1 - cent2;
  }

  correctFinal = (correctDollarTotal + correctCentTotal / 100).toFixed(2);

  document.getElementById("question").innerText =
    `$${dollar1}.${pad2(cent1)} ${operation} $${dollar2}.${pad2(cent2)}`;

  document.getElementById("dollarsAnswer").value = "";
  document.getElementById("centsAnswer").value = "";
  document.getElementById("finalAnswer").value = "";
  document.getElementById("feedback").innerText = "";
}

function showAnswerBox() {
  const details = document.getElementById("answerDetails");
  details.innerHTML = `
    Step 1 (dollars): ${dollar1} ${operation} ${dollar2} = <strong>${correctDollarTotal}</strong><br>
    Step 2 (cents): ${cent1}¬¢ ${operation} ${cent2}¬¢ = <strong>${correctCentTotal}¬¢</strong><br>
    Step 3 (total): <strong>$${correctFinal}</strong>
  `;
  document.getElementById("answerBox").style.display = "block";
}

function hideAnswerBox() {
  document.getElementById("answerBox").style.display = "none";
}

function normalizeFinalOk(inputStr) {
  if (inputStr === "") return false;
  const num = Number(inputStr);
  if (Number.isNaN(num)) return false;
  return num.toFixed(2) === correctFinal;
}

function checkAnswer() {
  const dollarInput = parseInt(document.getElementById("dollarsAnswer").value, 10);
  const centInput = parseInt(document.getElementById("centsAnswer").value, 10);
  const finalInput = document.getElementById("finalAnswer").value;

  const dollarsOk = dollarInput === correctDollarTotal;
  const centsOk = centInput === correctCentTotal;
  const finalOk = normalizeFinalOk(finalInput);

  if (dollarsOk && centsOk && finalOk) {
    scoreCorrect += 1;
    scoreTotal += 1;
    streak = masteryOn ? (streak + 1) : streak; // only track streak meaningfully when mastery is on
    updateHUD();

    if (masteryOn && streak >= masteryTarget) {
      document.getElementById("feedback").innerText =
        `üèÜ Mastery achieved!\nYou got ${masteryTarget} correct in a row.\nPress "New Question" to keep practising.`;
      // Keep streak capped at target for display neatness
      streak = masteryTarget;
      updateHUD();
    } else {
      document.getElementById("feedback").innerText = "‚úÖ Excellent! Well done!";
    }

    hideAnswerBox();
    attempts = 0;
    return;
  }

  // Wrong attempt
  attempts += 1;

  if (attempts >= 2) {
    // Count this question as attempted in score on the 2nd failed attempt
    scoreTotal += 1;

    // Mastery mode streak breaks on a counted wrong question
    if (masteryOn) streak = 0;

    updateHUD();
    document.getElementById("feedback").innerText =
      "‚ùå Not quite. Here are the correct answers.";
    showAnswerBox();
  } else {
    let msg = "‚ùå Not quite. Try again.\n";
    if (!dollarsOk) msg += "‚Ä¢ Check Step 1 (dollars).\n";
    if (!centsOk) msg += "‚Ä¢ Check Step 2 (cents).\n";
    if (dollarsOk && centsOk && !finalOk) msg += "‚Ä¢ Step 3: Combine dollars + cents correctly.\n";
    msg += "You have 1 more try.";
    document.getElementById("feedback").innerText = msg;
    hideAnswerBox();
  }
}

// Initialise
updateHUD();
generateQuestion();
</script>

</body>
</html>
